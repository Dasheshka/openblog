---
import ListCategories from "@/components/ListCategories.astro";
import ListPosts from "@/components/ListPosts.astro";
import Pagination from "@/components/Pagination.astro";
import TitlePage from "@/components/TitlePage.astro";
import { siteConfig } from "@/data/site.config";
import BaseLayout from "@/layouts/BaseLayout.astro";
import { getCategories, getPosts } from "@/utils";

export async function getStaticPaths({ paginate }: any) {
  const categories = await getCategories();
  const allPosts = await getPosts();

  return categories.flatMap((category) => {
    const filteredPosts = allPosts.filter((post) => post.data.category === category.value);

    console.log(
      paginate(filteredPosts, {
        params: {
          category: category.value
        },
        pageSize: siteConfig.paginationSize
      })
    );

    return paginate(filteredPosts, {
      params: {
        category: category.value
      },
      pageSize: siteConfig.paginationSize
    });
  });
}

const params = Astro.params;
const { page } = Astro.props;

const posts = page.data;
---

<BaseLayout title={params.category.label}>
  <TitlePage title={params.category.label} />
  <ListCategories activeCategory={params.category.value} />
  <ListPosts posts={posts} />
  <Pagination page={page} />
</BaseLayout>
