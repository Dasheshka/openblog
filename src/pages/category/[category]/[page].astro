---
import ListCategories from "@/components/ListCategories.astro";
import ListPosts from "@/components/ListPosts.astro";
import Pagination from "@/components/Pagination.astro";
import TitlePage from "@/components/TitlePage.astro";
import { siteConfig } from "@/data/site.config";
import Common from "@/layouts/Common.astro";
import { getCategories, getPosts } from "@/lib/content";

export async function getStaticPaths({ paginate }: any) {
  const categories = await getCategories();
  const allPosts = await getPosts();

  return categories.flatMap((category) => {
    const filteredPosts = allPosts.filter(
      (post) => post.data.category === category.value,
    );

    console.log(
      paginate(filteredPosts, {
        params: {
          category: category.value,
        },
        pageSize: siteConfig.postsPerPage,
      }),
    );

    return paginate(filteredPosts, {
      params: {
        category: category.value,
      },
      props: { category: category },
      pageSize: siteConfig.postsPerPage,
    });
  });
}

const { page, category } = Astro.props;

const posts = page.data;
---

<Common title={category.label}>
  <TitlePage title={category.label} />
  <ListCategories activeCategory={category.value} />
  <ListPosts posts={posts} />
  <Pagination page={page} />
</Common>
